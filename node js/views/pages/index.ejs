<!DOCTYPE html>
<html>
  <head>
    <title>Snímanie pohybu</title>
    <meta charets="utf-8">
    <link rel="stylesheet" type="text/css" href="/stylesheets/main.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  </head>
    <body onLoad="buildHtmlTable('#excelDataTable')">
    <div class="navbar">
        <ul>
            <li class="nav"><a href="index.ejs">Home</a></li>
            <li class="nav"><a href="about.ejs">About</a></li>
        </ul>
        </div>
        <h1>Database of sensoring</h1>
        <div class="inputs" align = "center">
            <label class="Settings">
                <h3>Light Settings</h3>
                <p>When would you like to turn the light on?</p>
                from <input type="time" name="usr_time">
                to <input type="time" name="usr_time">
                <button>Submit</button>
            </label>

            <h3>Filter</h3>
            <label>
                Choose a date <br>
                <input type="date" name="date" placeholder="2019.06.23" id="myInput" onclick="CreateTableFromJSON()" onchange="myFunction()">
            </label>
            <label>
                Choose a Time <br>
                <input type="time" name="usr_time" id="myInput" onclick="CreateTableFromJSON()" onchange="myFunction()">
            </label>
        </div>
        <table id="excelDataTable" align="center"></table>

<script>

        //Sets of data in JSON format
{       var data = [
            {
                "Date": "2019-05-23",
                "Time": "12:50"
            },
            {
                "Date": "2019-05-24",
                "Time": "12:43"
            },
            {
                "Date": "2019-05-26",
                "Time": "13:03"
            },
            {
                "Date": "2019-05-26",
                "Time": "13:03"
            },
            {
                "Date": "2019-05-27",
                "Time": "13:03"
            }
        ]
}

        function CreateTableFromJSON() {

            // EXTRACT VALUE FOR HTML HEADER.
            var col = [];
            for (var i = 0; i < data.length; i++) {
                for (var key in data[i]) {
                    if (col.indexOf(key) === -1) {
                        col.push(key);
                    }
                }
            }

            // CREATE DYNAMIC TABLE.
            var table = document.createElement("table");

            // CREATE HTML TABLE HEADER ROW USING THE EXTRACTED HEADERS ABOVE.
            var tr = table.insertRow(-1);                   // TABLE ROW.
            for (var i = 0; i < col.length; i++) {
                var th = document.createElement("th");      // TABLE HEADER.
                th.innerHTML = col[i];
                tr.appendChild(th);
            }

            // ADD JSON DATA TO THE TABLE AS ROWS.
            for (var i = 0; i < data.length; i++) {

                tr = table.insertRow(-1);

                for (var j = 0; j < col.length; j++) {
                    var tabCell = tr.insertCell(-1);
                    tabCell.innerHTML = data[i][col[j]];
                }
            }

            // FINALLY ADD THE NEWLY CREATED TABLE WITH JSON DATA TO A CONTAINER.
            var divContainer = document.getElementById("showData");
            divContainer.innerHTML = "";
            divContainer.appendChild(table);
        }

        function buildHtmlTable(selector) {
            var columns = addAllColumnHeaders(data, selector);
            for (var i = 0; i < data.length; i++) {
                var row$ = $('<tr/>');
                for (var colIndex = 0; colIndex < columns.length; colIndex++) {
                var cellValue = data[i][columns[colIndex]];
                if (cellValue == null) cellValue = "";
                row$.append($('<td/>').html(cellValue));
                }
                $(selector).append(row$);
            }
        }

        function addAllColumnHeaders(data, selector) {
            var columnSet = [];
            var headerTr$ = $('<tr/>');

            for (var i = 0; i < data.length; i++) {
                var rowHash = data[i];
                for (var key in rowHash) {
                if ($.inArray(key, columnSet) == -1) {
                    columnSet.push(key);
                    headerTr$.append($('<th/>').html(key));
                }
                }
                }
            $(selector).append(headerTr$);

            return columnSet;
        }

        function myFunction() {
            // Declare variables
            var input, filter, table, tr, td, i, txtValue;
            input = document.getElementById("myInput");
            filter = input.value.toUpperCase();
            table = document.getElementById("excelDataTable");
            tr = table.getElementsByTagName("tr");
            //filter = Value políčka zhora vo formáte: 2019-05-24
            //txtValue = To, čo je v bunke ktorú ideme práve porovnávať

            // Loop through all table rows, and hide those who don't match the search query
            for (i = 0; i < tr.length; i++) {
                debug2 = i;
                td = tr[i].getElementsByTagName("td")[0];
                if (td) {
                    txtValue = td.textContent || td.innerText;
                    if(txtValue.toUpperCase().indexOf(filter) > -1){
                        tr[i].style.display = "";
                    }
                    else {
                        tr[i].style.display = "none";
                    }
                }
            }
        }
</script>
    </body>
</html>